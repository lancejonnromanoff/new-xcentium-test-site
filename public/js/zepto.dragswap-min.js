!function(e){e.fn.dragswap=function(t){var n;function a(e){return e.is(f.excludePatt)}function i(t){var n=e(t);n.addClass(f.dropClass),n.on(f.prefix+"End",function(){n.removeClass(f.dropClass)},!1)}function o(t){if(!a(e(this)))return t.preventDefault(),t.stopPropagation(),!1;if(e(this).addClass(f.moveClass),n=this,t.originalEvent.dataTransfer)(i=t.originalEvent.dataTransfer).effectAllowed="move",i.setData("text",this.innerHTML);else if(t.dataTransfer){var i;(i=t.dataTransfer).effectAllowed="move",i.setData("text",this.innerHTML)}}function r(t){e(this).addClass(f.overClass)}function s(t){e(this).removeClass(f.overClass)}function d(e){return e.preventDefault&&e.preventDefault(),e.originalEvent.dataTransfer?e.originalEvent.dataTransfer.dropEffect="move":e.dataTransfer&&(e.dataTransfer.dropEffect="move"),!1}function l(t){if(t.stopPropagation&&t.stopPropagation(),!a(e(this)))return console.log("prevent drop"),!1;if(n!=this){var o={html:this.innerHTML,id:this.id},r={html:n.innerHTML,id:n.id};n.innerHTML=o.html,n.id=o.id,this.innerHTML=r.html,this.id=r.id,f.dropAnimation&&(i(this),i(n)),e(this).siblings().removeAttr("draggable"),e(this).siblings().filter(f.excludePatt).attr("draggable",!0),console.log("dropped"),f.dropComplete()}return!1}this.defaultOptions={element:"li",overClass:"over",moveClass:"moving",dropClass:"drop",dropAnimation:!1,exclude:".disabled",prefix:function(){var e=document.createElement("p"),t={webkitAnimation:"-webkit-animation",OAnimation:"-o-animation",msAnimation:"-ms-animation",MozAnimation:"-moz-animation",animation:"animation"};for(var n in document.body.insertBefore(e,null),t)if(void 0!==e.style[n])return e.style[n]="translate3d(1px,1px,1px)",window.getComputedStyle(e).getPropertyValue(t[n]),n;document.body.removeChild(e)}(),dropComplete:function(){}};var f=e.extend({},this.defaultOptions,t);if(f.exclude)if("string"!=typeof f.exclude){for(var m="",u=0;u<f.exclude.length;u++)m+=":not("+f.exclude[u]+")";f.excludePatt=m}else f.excludePatt=":not("+f.exclude+")";var v=String(t),c=[];return/^(toArray|toJSON)$/.test(v)?"toArray"==v?(e(this).find(f.element).each(function(e,t){c.push(this.id)}),c):"toJSON"==v?(e(this).find(f.element).each(function(e,t){c[e]={id:this.id}}),JSON.stringify(c)):void 0:this.each(function(t,n){var a=e(this),i=a.find(f.element);new MutationObserver(function(t){console.log(t);for(var n=0;n<t.length;n++)if(0!=t[n].addedNodes.length)for(var a=0;a<t[n].addedNodes.length;a++)e(t[n].addedNodes[a]).siblings().removeAttr("draggable"),e(t[n].addedNodes[a]).siblings().filter(f.excludePatt).attr("draggable",!0)}).observe(this,{childList:!0}),i.filter(f.excludePatt).attr("draggable",!0),a.off("dragstart"),a.off("dragenter"),a.off("dragover"),a.off("dragleave"),a.off("drop"),a.off("dragend"),a.on("dragstart",f.element,o),a.on("dragenter",f.element,r),a.on("dragover",f.element,d),a.on("dragleave",f.element,s),a.on("drop",f.element,l),a.on("dragend",f.element,function(t){a.removeClass(f.moveClass),(i=a.find(f.element)).each(function(t,n){e(n).removeClass(f.overClass),e(n).removeClass(f.moveClass)})})})}}(Zepto);